import{m as F,e as z,c as M,f as P,j as G,g as nt,k as $}from"./game-stores-BGb63l6J.js";import{S as E,T as J,R as rt,A as at,a as ct,G as lt}from"./vendor-pixi-DFkI6Qzo.js";import{j as l,e as j,r as k,a as K}from"./vendor-react-core-CGDK1b01.js";import{M as C,a as ht,b as ut,P as dt,B as X,T as pt,F as ft,s as mt,g as W,k as yt,D as R,A as et,u as xt,c as T}from"./game-components-DqIOe6Op.js";import{i as L}from"./vendor-i18n-QAcnuH6y.js";const it=[],gt=i=>{const t=["underworld_spirit","trap2"];for(const s of t)if(i.startsWith(s))return!0;return!1},Lt=(i,t,s,o,n,r,h,c,u,f="x")=>{const m={state:"alive",size:c,id:i,position:{x:t,y:s},speed:r,patrolArea:[o,n],directionAxis:f,direction:f==="x"?"right":"down",type:h,onGround:!0,velocityY:0,velocityX:0,isAngry:u,update(e){if(this.state==="dead")return;if(this.type.includes("#chasing")){const x=z.getState().position,y=x.x-this.position.x,v=x.y-this.position.y,g=Math.hypot(y,v);if(g===0){this.velocityX=0,this.velocityY=0;return}this.velocityX=y/g*this.speed,this.velocityY=v/g*this.speed,Math.abs(y)>Math.abs(v)?this.direction=y>0?"right":"left":this.direction=v>0?"down":"up"}else this.directionAxis==="x"?(this.direction==="right"?this.position.x<this.patrolArea[1]?this.velocityX=this.speed:this.direction="left":this.position.x>this.patrolArea[0]?this.velocityX=-this.speed:this.direction="right",this.velocityY=0):(this.direction==="down"?this.position.y<this.patrolArea[1]?this.velocityY=this.speed:(this.direction="up",this.position.y-=1):this.position.y>this.patrolArea[0]?this.velocityY=-this.speed:(this.direction="down",this.position.y+=1),this.velocityX=0);const d=It({x:this.position.x,y:this.position.y},this.size,this.velocityX,this.velocityY,e,!1,gt(this.type));this.position=d.position,this.velocityY=d.velocityY,this.velocityX=d.velocityX,this.onGround=d.onGround},kill(){this.state="dead",this.velocityX=0,this.velocityY=0,F.getState().show(L.t("translations:enemy.killedToast"))},pet(){const e=L.t(`translations:enemy.${this.type.split("_")[0]}`);F.getState().show(L.t("translations:enemy.petToast",{name:e}))}};return it.push(m),m},wt={spring:{id:"spring",level:"5",goal:5,itemId:2,butterflyId:4,itemName:"flower",deliverTo:"bag",description:"Collect and deliver 5 flowers.",action:()=>M.getState().open(l.jsx(C,{season:"spring"}))},summer:{id:"summer",level:"5",goal:1,itemId:13,butterflyId:9,itemName:"butterfly",description:"Survive the maze and reach the butterfly.",action:()=>M.getState().open(l.jsx(C,{season:"summer"}))},autumn:{id:"autumn",level:"5",goal:5,itemId:8,butterflyId:10,itemName:"box",deliverTo:"highlightZone",description:"Deliver 5 boxes to the highlighted areas.",action:()=>M.getState().open(l.jsx(C,{season:"autumn"}))},winter:{id:"winter",level:"5",goal:1,itemId:13,butterflyId:3,itemName:"butterfly",description:"TBD",action:()=>M.getState().open(l.jsx(C,{season:"winter"}))}},Z=[{id:1,source:"assets/items/memory.png",amount:0,action:()=>M.getState().open(l.jsx(ht,{})),height:2},{id:7,source:"assets/items/music.png",amount:0,action:()=>M.getState().open(l.jsx(ut,{}))},{id:13,source:"assets/items/portal.png",amount:0,action:()=>M.getState().open(l.jsx(dt,{}))},{id:3,source:"assets/items/item_winter.png",amount:0,action:()=>M.getState().open(l.jsx(X,{title:"Зиму"}))},{id:4,source:"assets/items/item_spring.png",amount:0,action:()=>M.getState().open(l.jsx(X,{title:"Весну"}))},{id:9,source:"assets/items/item_summer.png",amount:0,action:()=>M.getState().open(l.jsx(X,{title:"Лето"}))},{id:10,source:"assets/items/item_autumn.png",amount:0,action:()=>M.getState().open(l.jsx(X,{title:"Осень"}))},{id:2,source:"assets/items/item_flower.png",amount:0,action:()=>{}},{id:8,source:"assets/items/item_box.png",amount:0,action:()=>{}}],Ot=[{...Z[0],amount:1},{...Z[1],amount:1}],st={fountain:()=>M.getState().open(l.jsx(ft,{})),bag:()=>{P.getState().deliverItem()},shelf:()=>{P.getState().takeBoxFromShelf()},tablet:()=>{M.getState().open(l.jsx(pt,{}))}},St=i=>{const t=["trap"];for(const s of t)if(i.startsWith(s))return!0;return!1},vt=i=>i in st;function bt(i,t,s,o,n,r,h){const c=[],u=P.getState(),f=u.currentMiniGame?wt[u.currentMiniGame]:null,m=(e,w,d,x,y)=>Mt(i,t,s,o,e,w,d,x,y);if(f?.id==="autumn"){const e=u.deliveryZones[u.activeDeliveryZoneIndex];m(e.x,e.y,24,24,16)&&u.carriedItem&&c.push({id:`box_zone-${e.x}-${e.y}`,visible:!0,x:e.x,y:e.y,key:"use",title:"useTheObstacle",action:u.deliverItem,holdable:!0,holdDuration:750})}for(const e of it)e.state==="dead"||St(e.type)||!(e.isAngry?m(e.position.x,e.position.y,e.size.width,e.size.height,52):m(e.position.x,e.position.y,e.size.width,e.size.height,24))||c.push({id:`enemy-${e.id}`,visible:!0,x:e.position.x,y:e.position.y,key:"interact",title:e.isAngry?"enemy.kill":"enemy.pet",action:()=>{e.isAngry?e.kill():e.pet()},holdable:!0,holdDuration:1e3});for(const e of n){if(!e.visible||!(e.type.startsWith("door")||e.type==="fountain"||e.type==="tablet"||(e.type==="bag"||e.type==="shelf")&&u.currentMiniGame)||!m(e.x,e.y,e.width,e.height,32))continue;const x=`${e.type}-${e.x}-${e.y}`;if(e.type.startsWith("door")){const y=e.x===0?"left":"right";c.push({id:x,visible:!0,x:e.x,y:e.y,key:"use",title:"enterTheDoor",action:()=>G.getState().enterDoor(y)})}else vt(e.type)&&c.push({id:x,visible:!0,x:e.x,y:e.y,key:"use",title:"useTheObstacle",action:st[e.type],holdable:e.type==="bag"||e.type==="shelf"})}for(const e of r){if(!e.visible||!m(e.x,e.y,e.size.width,e.size.height,16))continue;const d=Z.find(g=>g.id===e.id);if(!d)continue;const x=nt.getState(),y=f&&e.id===f.itemId,v=f?.butterflyId===e.id;c.push({id:`item-${e.x}-${e.y}-${e.type}`,visible:!0,x:e.x,y:e.y,key:"use",title:"pickupItem",action:()=>{if(y&&x.getItem(e.id)){const g=L.t("translations:overload");F.getState().show(g);return}x.addItem(d.id),v?u.finishMiniGame():f&&P.setState({carriedItem:d.id}),$.setState(g=>({items:g.items.map(a=>a.x===e.x&&a.y===e.y&&a.id===e.id?{...a,visible:!1}:a)}))},holdable:e.type.startsWith("flower")})}for(const e of h){if(!e.visible||!m(e.x,e.y,e.size.width,e.size.height,16))continue;const d=mt.find(x=>x.id===e.id);d&&c.push({id:`spirit-${e.id}`,visible:!0,x:e.x,y:e.y,key:"use",title:"talkToSpirit",action:d.action})}return c}const Mt=(i,t,s,o,n,r,h,c,u)=>i<n+h+u&&i+s>n-u&&t<r+c+u&&t+o>r-u,H=(i,t)=>i.x<t.x+t.width&&i.x+i.width>t.x&&i.y<t.y+t.height&&i.y+i.height>t.y,O=(i,t)=>{const s=i.x+i.width/2,o=i.y+i.height/2,n=t.x+t.width/2,r=t.y+t.height/2,h=n-s,c=r-o,u=(i.width+t.width)/2,f=(i.height+t.height)/2;if(Math.abs(h)<u&&Math.abs(c)<f){const m=u-Math.abs(h),e=f-Math.abs(c);return m<e?h>0?"left":"right":c>0?"top":"bottom"}return null},Rt=()=>{const{position:i,size:t}=z.getState(),{enemies:s}=$.getState(),o={x:i.x,y:i.y,width:t.width,height:t.height};for(const n of s){if(n.state==="dead"||!n.isAngry)continue;const r={x:n.position.x,y:n.position.y,width:n.size.width,height:n.size.height};O(o,r)!==null&&G.getState().lose()}},B=i=>{const t=["fountain","tree","grass","flower","snowman","tablet"];for(const s of t)if(i.startsWith(s))return!0;return!1},U=i=>{const t=["trap","water","fire"];for(const s of t)if(i.startsWith(s))return!0;return!1},It=(i,t,s,o,n,r,h)=>{const{obstacles:c,gravity:u,items:f,spirits:m,isMiniGame:e}=$.getState(),w=t.width,d=t.height;let x=s,y=o;Math.abs(y)<.1&&(y=0);const v=n/1e3*(e?1.3:1);let g=i.x+x*v,a=i.y+y*v,S=!1;const I={x:!1,y:!1},Y=r?bt(g,a,w,d,c,f,m):null;let N=!1;if(h)return{position:{x:g,y:a},velocityX:x,velocityY:y,onGround:S,stacked:I,nearInteractive:Y,onLadder:N};const D={x:i.x,y:a,width:w,height:d};for(const p of c){if(!p.visible||B(p.type))continue;const b={x:p.x,y:p.y,width:p.width,height:p.height},A=O(D,b);if(A){if(U(p.type)&&r&&H(D,b)&&G.getState().lose(),p.type==="portal"&&r&&P.getState().finishMiniGame(),p.type.startsWith("ladder")&&r){r&&(N=!0);continue}A==="left"?(g=p.x-w,x=0,I.x=!0):A==="right"&&(g=p.x+p.width,x=0,I.x=!0)}}const V={x:g,y:a,width:w,height:d};for(const p of c){if(!p.visible||B(p.type))continue;const b={x:p.x,y:p.y,width:p.width,height:p.height};if(p.type.startsWith("ladder")&&r){if(!r)continue;if(H(V,b)){N=!0,S=!1;continue}}const A=O(V,b);A&&(U(p.type)&&r&&H(D,b)&&G.getState().lose(),p.type==="portal"&&r&&P.getState().finishMiniGame(),A==="top"?(a=p.y-d,y=0,S=!0,I.y=!0):A==="bottom"&&(a=p.y+p.height,y=0,I.y=!0))}if(!S){const p={x:g+1,y:a+d,width:w-2,height:1};for(const b of c){if(!b.visible||b.type.startsWith("ladder")||B(b.type))continue;const A={x:b.x,y:b.y,width:b.width,height:b.height};if(O(p,A)==="top"){S=!0,y=0,a=b.y-d,I.y=!0;break}}}return S||(y+=u*v),{position:{x:g,y:a},velocityX:x,velocityY:y,onGround:S,stacked:I,nearInteractive:Y,onLadder:N}};j({Sprite:E});const Tt=({x:i,y:t,texture:s,size:o})=>s&&l.jsx("pixiSprite",{x:i,y:t,texture:s,width:o.width,height:o.height,eventMode:"static",zIndex:1}),Dt=k.memo(()=>$(t=>t.obstacles).filter(t=>t.visible).map((t,s)=>l.jsx(Tt,{x:t.x,y:t.y,size:{width:t.width,height:t.height},texture:W(t.type)},`${s}-${t.type}`)));j({Sprite:E});const jt=({x:i,y:t,texture:s,size:o})=>s&&l.jsx("pixiSprite",{x:i,y:t,texture:s,width:o.width,height:o.height,eventMode:"static",zIndex:2}),Ht=k.memo(()=>$(t=>t.items).filter(t=>t.visible).map(t=>l.jsx(jt,{x:t.x,y:t.y,size:t.size,texture:W(`${t.type}`)},`${t.id}-${t.x}-${t.y}`)));function ot({texture:i,frameWidth:t,frameHeight:s,animations:o,animationSpeed:n}){const r=k.useRef(0),h=k.useRef(0),c=k.useRef(J.EMPTY),u=k.useRef(""),f=z(a=>a.velocityX),m=z(a=>a.velocityY),e=z(a=>a.onGround),w=z(a=>a.onLadder),d=$(a=>a.isMiniGame),{action:x,direction:y}=k.useMemo(()=>{let a="idle",S="right";const I=!e&&Math.abs(m)>.1,Y=Math.abs(f)>.5,N=Math.abs(m)>.5;return w?(a="climb",S=yt.up?"up":"down"):I?(a="jump",S=f<0?"left":"right"):d?(Y||N)&&(a="walk",Math.abs(f)>Math.abs(m)?S=f<0?"left":"right":S=m<0?"up":"down"):Y&&(a="walk",S=f<0?"left":"right"),d&&(a==="climb"||a==="jump")&&(a="walk",S=m<0?"up":"down"),{action:a,direction:S}},[f,m,e,w,d]);let v=`${x}-${y}`;d&&(v+="-mini-game");const g=o[v]||o["idle-right"];return v!==u.current&&(r.current=0,h.current=0,u.current=v),K(a=>{const S=a.deltaMS/16.666666666666668;h.current+=S,x=="idle"&&(n*=3),h.current>=n&&(h.current=0,r.current=(r.current+1)%g.frames);const I=new rt(r.current*t,g.row*s,t,s);c.current=new J({source:i.source,frame:I})}),c.current}j({Sprite:E});const kt=({x:i,y:t,texture:s,size:o})=>{const r=ot({texture:s,frameWidth:R,frameHeight:R,animations:{"idle-right":{row:24,frames:2}},animationSpeed:et});return l.jsx("pixiSprite",{x:i,y:t,texture:r,width:o.width,height:o.height,zIndex:9,eventMode:"static"})},Bt=()=>$(t=>t.spirits).filter(t=>t.visible).map(t=>l.jsx(kt,{x:t.x,y:t.y,size:t.size,texture:W(`${t.type}`)},t.id));j({Sprite:E});const At=({x:i,y:t,texture:s,size:o,type:n})=>{const r=k.useRef(null),h=n.includes("trap2"),c=.1;return K(u=>{const f=u.deltaTime;h&&r.current&&(r.current.rotation+=c*f)}),s&&l.jsx("pixiSprite",{ref:r,x:i+o.width/2,y:t+o.height/2,anchor:.5,texture:s,width:o.width,height:o.height,eventMode:"static",zIndex:10})},Ft=()=>$(t=>t.enemies).filter(t=>t.state!=="dead").map(t=>l.jsx(At,{x:t.position.x,y:t.position.y,texture:W(t.type.split("#")[0]),size:t.size,type:t.type},t.id));j({Sprite:E});const zt=({x:i,y:t})=>{const s=at.get("fire"),c=xt({texture:s,frameWidth:T,frameHeight:T,frameCount:8,animationSpeed:6});return l.jsx("pixiSprite",{x:i,y:t,texture:c,width:T,height:T,zIndex:0,eventMode:"static"})};j({Sprite:E});const $t=({x:i,y:t,texture:s})=>s&&l.jsx("pixiSprite",{x:i,y:t,texture:s,width:T*2,height:T*2,eventMode:"static",zIndex:1}),Zt=k.memo(()=>$(t=>t.decorations).filter(t=>t.visible).map(t=>{if(t.type.startsWith("fire"))return l.jsx(zt,{x:t.x,y:t.y},`${t.x}-${t.y}-${t.type}`);if(t.type.startsWith("tree"))return l.jsx($t,{x:t.x,y:t.y,texture:W(t.type)},`${t.x}-${t.y}-${t.type}`)})),Et={"idle-right":{row:24,frames:2},"idle-left":{row:24,frames:2},"walk-right":{row:11,frames:9},"walk-left":{row:9,frames:9},"climb-up":{row:21,frames:6},"climb-down":{row:21,frames:6},"jump-right":{row:28,frames:5},"jump-left":{row:28,frames:5},"idle-up-mini-game":{row:20,frames:2},"idle-down-mini-game":{row:22,frames:2},"idle-left-mini-game":{row:24,frames:2},"idle-right-mini-game":{row:22,frames:2},"walk-up-mini-game":{row:8,frames:9},"walk-down-mini-game":{row:10,frames:9},"walk-left-mini-game":{row:9,frames:9},"walk-right-mini-game":{row:11,frames:9}};j({Sprite:E});const Gt=({x:i,y:t,texture:s,size:o})=>{const n=ot({texture:s,frameWidth:R,frameHeight:R,animations:Et,animationSpeed:et});return l.jsx("pixiSprite",{zIndex:10,x:i,y:t,texture:n,width:o.width,height:o.height,eventMode:"static"})},Kt=()=>{const i=G(n=>n.status),t=z(n=>n.texture),s=z(n=>n.position),o=z(n=>n.size);return t&&i!=="lost"&&l.jsx(Gt,{x:s.x,y:s.y,texture:t,size:o})};j({TilingSprite:ct});const Vt=({texture:i})=>l.jsx("pixiTilingSprite",{texture:i,width:42*T,height:24*T,tileScale:{x:1,y:1}});j({Sprite:E});const q=({x:i,y:t,texture:s})=>s&&l.jsx("pixiSprite",{x:i,y:t,texture:s,width:T*5,height:T*5,eventMode:"static",zIndex:-2}),_=12e4*2,Q=5*T,Nt=_/2,Jt=({sunTexture:i,moonTexture:t,containerWidth:s,containerHeight:o})=>{const r=G(e=>e.curTime)%_,h=o*.15,c=o*.08;function u(e){const w=e*(s+2*Q)-Q,d=h+Math.sin(e*Math.PI)*-c;return{x:w,y:d}}const f=r/_,m=(r+Nt)%_/_;return l.jsxs(l.Fragment,{children:[l.jsx(q,{...u(f),texture:i}),l.jsx(q,{...u(m),texture:t})]})};j({Graphics:lt});const tt=12e4*2,Ut=({containerWidth:i,containerHeight:t})=>{const n=G(h=>h.curTime)%tt/tt,r=.05+.4*(1-Math.cos(2*Math.PI*(n-.25)))/2;return l.jsx("pixiGraphics",{draw:h=>{h.clear(),h.fill({color:"black",alpha:r}),h.rect(0,0,i*2,t*2),h.fill()},zIndex:999})};j({Sprite:E});const qt=({x:i,y:t,texture:s,width:o,height:n,speed:r,boundsWidth:h})=>{const c=k.useRef(null);return K(u=>{c.current&&(c.current.x+=r*(u.deltaMS/1e3),c.current.x>h&&(c.current.x=-o))}),l.jsx("pixiSprite",{ref:c,x:i,y:t,texture:s,width:o,height:n,eventMode:"static",zIndex:0})};export{qt as C,Zt as D,Ft as E,jt as I,Vt as M,Dt as O,Kt as P,Ut as S,Jt as a,Ht as b,Bt as c,Z as d,it as e,wt as f,Lt as g,Rt as h,Ot as i,It as j};
